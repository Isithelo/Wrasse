<style type="text/css">
	.awesome {
		padding: 2px;

		border-radius: 5px;
		background: #5cb85c;
	}
</style>

<div class="row">
	<div class="col-md-3">
		<h3>Upgrade your plan</h3>
		<div>
			<div>  
				<a href="#">
					{{#if user.image}}
					<div onerror="this.src='{{user.gravatar}}'"" id="googlepic" style="min-width: 25%"></div>
					{{else}}
					<img src="{{user.gravatar}}" class="media-object">
					{{/if}}
				</a>
			</div>
		</div>
		<h4>{{user.name}}  <small>{{user.username}}</small></h4>
		<hr>
		<h5>Current plan</h5>
		<strong>Free plan</strong>, Unlimited public repositories</strong>
		<hr>
		<h5>Upgrading to</h5>
		<strong>Developer</strong>, Unlimited private repositories
	</strong>
	<hr>
	<h5>New plan price</h5>
	<h1 id="pricing">$7.00 USD / Month</h1>
</div>
<div class="col-md-9">
      {{#if messages.success}}
      <div role="alert" class="alert alert-success">
        {{#each messages.success}}
        <div>{{msg}}</div>
        {{/each}}
      </div>
      {{/if}}
      {{#if messages.error}}
      <div role="alert" class="alert alert-danger">
        {{#each messages.error}}
        <div>{{msg}}</div>
        {{/each}}
      </div>
      {{/if}}

		<h2>Billing</h2>
		<hr> 

<div class="row">
 
	<div class="col-md-12" style="">
		 
		<p></p>
		<!--THis is the inserted paypal button directly from your paypal account -->
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="hosted_button_id" value="5LHXZ6Q2PTKXW">
<table style="width: 50%">
<tr><td><input type="hidden" name="on0"  value=""></td></tr><tr><td ><select id="selector"  class="form-control" name="os0">
	<option value="Option 1">$7.00 USD / Month</option>
	<option value="Option 2">$84.00 USD / Yearly</option>
</select> </td></tr>
</table>

<p></p>
		<div class="awesome">
			<div class="panel panel-default" style="margin-bottom: 1px;border-color: #5cb85c; "  >
				<div class="panel-body" >
					Charge today
					<h1 id="pricingNow">$7.00 USD / Month</h1>
				</div>
				<div class="panel-footer">Your next charge will be on <span id="dates"></span>.</div>
			</div>
		</div>
		<p></p>   <p>
		By clicking on "Subscribe" , you are agreeing to the <a href="/terms" target="_blank">Terms of Service</a> and the <a href="/privacy" target="_blank">Privacy Policy</a>.
	</p>

<input type="hidden" name="currency_code" value="USD">
<input type="image" style="padding-top: 15px" src="https://www.paypalobjects.com/en_US/i/btn/btn_subscribeCC_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
</form>
<p>You will be forwarded to the secure PayPal website </p> 
</div>
<p ></p>
<div class="col-md-12" style="padding-top: 15px">
 
 


{{#if user.plan.name}}
		<a class="btn btn-outline-secondary" href="/users/{{user.username}}/cancel_subscription">Cancel Subscription</a>
{{else}}
 
 
	{{/if}}	
	</div>
</div>	</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script src="https://js.braintreegateway.com/web/dropin/1.4.0/js/dropin.min.js"></script>
<script type="text/javascript">
	var username = JSON.stringify('{{user.username}}')
	var user = JSON.stringify('{{user.username}}')
	var text = '{{user.picture}}'
	text =text.replace("sz&#x3D;50", "sz&#x3D;200");
	$('#googlepic').html('<img src="'+text+'" style="max-width: 50%;border-radius: 2px;border: 1px;border-color: #d8d8d8;border-style: solid;" class="media-object">')
	var checkout;
 
 
//////////////////////////////////////////////////////
////        AJAX SUBMIT THE FORM - CREATE        //// 
////////////////////////////////////////////////////
function formPost(payload){
	var moredata = payload.nonce;
	$input = $('<input type="text" name="payload" style="display:none"/>').val(moredata);
	$('#theForm').append($input);
	var datastring = $('#theForm').serialize()
	$.ajax({
		type: "POST",
		url: '/users/'+username+'/subscription',
		data: datastring,
		dataType: "json",
		success: function(data) {
			 window.location = '/users/'+username+'/settings/billing';	
		},
		error : function(err){
			console.log('Not working')
			window.location = '/users/'+username+'/settings/billing';	
		}
	}); 
}

////////////////////////
///// INITIALIZE //////
//////////////////////
$(document).ready( function() {
	months()
	years()
});


$('#selector').change(function(){
 
	$('#pricingNow').html($('#selector option:selected').text())
	$('#pricing').html($('#selector option:selected').text())
	
	
})


////////////////////////////////
///// HANDLING THE DATES //////
//////////////////////////////
function months(){
	var datevalue = moment().add(1, 'M').format('YYYY-MM-DD');
	$('#dates').html(datevalue)
}
////////////////////////////////
///// HANDLING THE DATES //////
//////////////////////////////
function years(){
	var datevalue = moment().add(1, 'Y').format('YYYY-MM-DD');
	$('#dates').html(datevalue)
}
</script>

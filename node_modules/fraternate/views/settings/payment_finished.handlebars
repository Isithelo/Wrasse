 

<div class="login-container container">
  <div style="text-align: center">
   <img src="/img/Logo square 300x300.png" style="height: 55px">  
 </div>
 <div id="userDetails"></div>

 <div id="msg">

    <h1>Success</h1>
 <div>
  <p align="justify">Thanks for subscribing, should your payment details not reflect, Click on the refresh button to check again.</p>
</div>



<div class="btn-group" role="group" aria-label="...">
  <a type="button" onclick="checkUser()" class="btn btn-primary">Refresh User Details</a>
  <a href='/contact' target="_blank" type="button" class="btn btn-primary">Contact us</a>
</div>


<p></p>
 </div>

 <div id="code"></div>
</div>



<script type="text/javascript">

////////////////////////
///// INITIALIZE //////
//////////////////////
$(document).ready( function() {
 checkUser()
});

//////////////////////////////////
///// RECHECK USER DETAILS //////
////////////////////////////////
function checkUser(){
  var ids = '{{user._id}}'
  $('#userDetails').html('<div style="text-align:center;padding:25px"><i class="fa fa-spinner fa-pulse"></i> Loading</div>')
if (ids.length) {
   jQuery.ajax({
    'url': '/profilepic?ids='+ids,
    'async': true,
    'global': false,
    'success': function (dataSchemaObject) {
      var dataSchemaObject = JSON.parse(dataSchemaObject)
      var html=''
      html+='<div class="row">'
      html+='<div class="col-md-8" style="text-align: right;">'
      html+='<a href="/users/'+dataSchemaObject.username+'" style="color: black;text-decoration: none">'
      html+='<h1>{{user.name}} {{user.username}} <small>'+dataSchemaObject.username+'</small></h1>'
      html+='</a>'
      html+='</div>'
      html+='<div class="col-md-4">'
      html+='<a href="/users/'+dataSchemaObject.username+'">'
      if (dataSchemaObject.image){
        html+='  <div onError="this.onerror=null;this.src='+dataSchemaObject.gravatar+';"  id="googlepic" style="border-radius:15px!important;width: 100%;border-radius: 5px;border: 1px;border-color: #d8d8d8;border-style: solid;min-height: 80px"><img src="'+dataSchemaObject.image+'" style="width: 100%;border-radius:15px;" class="media-object"></div>'
      } else {
        html+=' <img src="'+dataSchemaObject.gravatar+'" style="width: 100%;border-radius:15px;border: 1px;border-color: #d8d8d8;border-style: solid;min-height: 130px" class="media-object">'
      }
      html+='  </a>'
      html+='</div>'
      html+='<div class=" col-md-12">'
      html+='<h4>Plan</h4>'
      if (dataSchemaObject.plan) {
        if (dataSchemaObject.plan.name){ 
          html+='<div class="well">'
          html+='<strong>Developer</strong>, Unlimited private repositories</strong>'
          html+='</div>'
          html+=' <a class="btn btn-outline-secondary" href="/users/'+dataSchemaObject.username+'/settings/billing/" ><i class="fa fa-pencil" aria-hidden="true"></i> Edit Subscription</a>'
        } else {
         html+=' <div class="well">'
         html+=' <strong>Free plan</strong>, unlimited public repositories</strong>'
         html+='</div>'
         html+='<p><a class="btn btn-outline-secondary" href="/users/'+dataSchemaObject.username+'/settings/billing/upgrade_payfast">Get private repositories</a></p>'
       }
     } else {
       html+=' <div class="well">'
       html+=' <strong>Free plan</strong>, unlimited public repositories</strong>'
       html+='</div>'
       html+='<p><a class="btn btn-outline-secondary" href="/users/'+dataSchemaObject.username+'/settings/billing/upgrade_payfast">Get private repositories</a></p>'
     }
     html+='</div>'
     html+='</div>'
     html+='</div>'
     $('#userDetails').html(html)
     html=''
//html+='<div class="col-xs-12 col-md-12">'
    // html+='<pre>'+JSON.stringify(dataSchemaObject, null, 4)+'</pre>'
   //html+='</div>'
    // $('#code').html(html)
  },'error' : function(err){
    console.log(err)
  }
});
} else {
  window.location = "/signin"
}


}

</script>


 <!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="msvalidate.01" content="6F54F88A443C656EFB178CEF11C4E7E9" />
  <meta name="google-site-verification" content="V6ZQykcqytIxvH_JCfowxQfGXB9Qn-rgaQ-iIrtoW3c" />
  <title>{{pagetitle}}</title>
  {{> css}}
  {{>javascript}}
 <style type="text/css">
 .success-steps{
  background-color: #0366d9;
  color:white;
}
    .mid-align {
      width: 100px;
      height: 100px;
      
      position: absolute;
      top:-85%;
      bottom: 0;
      left: 0;
      right: 0;
      
      margin: auto;
    }
</style>
<script src='https://www.google.com/recaptcha/api.js'></script>

</head>




<body>

<div class="container ">
  <div class="row justify-content-md-center mid-align ">
 
    <div class="col-md-auto ">
      <div class="card">
        <div class="card-body">
           <div style="text-align: center;">
            <a href="/">
             <img src="/img/Logo square 300x300.png" style="height: 55px">   
           </a>
         </div>
         <div style="text-align: center;padding-bottom: 15px">
          <h4>Sign up to {{sitename}}</h4><p></p>
          <a href="/terms">Terms</a>   |   <a href="/privacy">Privacy</a>   |   <a href="/contact" style="color: grey">Contact the {{siteName}} team</a>
          <p></p>
        </div>
  <table class="table table-bordered" style="border-radius: 5px">
    <tr>
      <td style="padding-bottom: 22px;width: 33%;text-align: center;color:grey">
       <h3 style="color:grey"><i class="fas fa-check"></i> <strong class="step" style="font-size:24px">Step 1</strong></h3>
       Create a personal account. (Complete)
     </td>
     <td style="padding-bottom: 22px;width: 33%;text-align: center;"  class="success-steps">
      <h3 ><strong class="step" style="font-size:24px">Step 2</strong></h3>
      Choose your plan.
    </td>
    <td style="padding-bottom: 22px;width: 33%;text-align: center;color:grey">
     <h3 style="color:grey"><strong class="step" style="font-size:24px" style="color:grey">Step 3</strong></h3>
     Tailor your experience
   </td>
 </tr>
</table>


{{#if messages.error}}
<div role="alert" class="alert alert-danger">
  {{#each messages.error}}
  <div>{{msg}}</div>
  {{/each}}
</div>
{{/if}}


<div class="row">
  <div class="col-md-12">
    {{#if messages.success}}
    <div role="alert" class="alert alert-success">
      {{#each messages.success}}
      <div>{{msg}}</div>
      {{/each}}
    </div>
    {{/if}}
    {{#if messages.error}}
    <div role="alert" class="alert alert-danger">
      {{#each messages.error}}
      <div>{{msg}}</div>
      {{/each}}
    </div>
    {{/if}}
  </div>
</div>

<label for="radios" class="col-md-12 display-4 ">Choose your plan</label>

<div class="col-md-12">
</div> 





<ul class="list-group">
  <div class="list-group-item">
    <input type="radio" name="radios" id="radios-0" value="1" checked="checked" class="free" >
    <strong>Free</strong>
    <div class="row">
      <div class="col-md-12">
       <h5 class="mt-4">Free plan   <small>Unlimited public repositories</small></h5>
       <div id="button" class="mt-4" style="text-align: right;">
        <a href="/signup-step3" class="btn btn-success">Continue to Step 3</a>
      </div>
    </div>
  </div>
</div>

<div class="list-group-item">
  <input type="radio" name="radios" id="radios-1" value="2"  class="teampay">
  <strong>Developer</strong>
  <div class="row">
    <div class="col-md-12">
      <h5 class="mt-4">Upgrading to</h5>
      <strong>Developer</strong>, Unlimited private repositories
    </div>

    <div class="col-md-12" style="text-align: right;">
      <h3><span id="pricing">ZAR 100.00 / month</span>
      </h3>
    </div>

    <div class="col-md-12" style="padding-top: 15px">
      <div id="payment">
        <div class="row">
              <div class="col-md-6">
            <a class="btn btn-outline-primary" data-price="100.00" data-cycles="0" data-frequency="3" id="btn1" onclick="price(this.id)" >
             ZAR 100.00  / Month
           </a>
           <small>Your next charge will be on <span id="dates"></span>.</small>  
         </div>

         <div class="col-md-6">
          <a class="btn btn-outline-primary collapsed" data-price="1200.00" data-cycles="0" data-frequency="6" id="btn2" onclick="price(this.id)" >
            ZAR 1 200.00 / Year
          </a>  
          <small>Your next charge will be on <span id="years"></span>.</small>   
        </div>

        </div>
     


       <div class="col-md-12">
<div style="text-align: center;padding-top: 35px" id='buttonss'></div>
 </div> 
</div> 
</div> 
</div>
</div> 
</ul>

</div></div>


    </div>
 
  </div>
</div>



 



<script type="text/javascript">
    var amount = '100.00'
    var frequency = '3'
 
/////////////////////////////
//////  INTITIALIZE  ///////
///////////////////////////
$('document').ready(function(){
  buttonUpdate(amount,frequency)
})


$('#custom_str2').change(function(){
  buttonUpdate(amount,frequency)
})

////////////////////////////////
//////  ADD THE BUTTON  ///////
//////////////////////////////
function buttonUpdate(amount,frequency){
    var billingname = $('#custom_str2').val()
  $('#buttonss').html( '<a href="{{URLPAYFAST}}?cmd=_paynow&amp;receiver={{MERCHANTIDPAYFAST}}&amp;item_name=Subscription&amp;item_description=Subscribe+to+this+site.&amp;amount='+amount+'&amp;return_url={{website}}organizations/new-payfast-step3/{{organization.entry.name}}&amp;cancel_url={{website}}payment_org_cancelled&amp;notify_url={{website}}payment_org_notify&amp;cycles=0&amp;frequency='+frequency+'&amp;m_subscription_id=pay_now_12600984&amp;m_payment_id={{organization._id}}&amp;payment_id={{organization._id}}&amp;custom_str1={{{user.email}}}&amp;custom_str2='+billingname+'&amp;subscription_type=1"><img src="https://www.payfast.co.za/images/buttons/dark-large-subscribe.png" width="210" height="59" alt="Subscribe" title="Subscribe Now with PayFast"  /></a>')
}
</script>

<script type="text/javascript">
  $(".hiddenInput").hide();
  $(".hiddenInputs").hide();
  $("#payment").hide();
  $(".showHideCheck").on("change", function() {
    $this = $(this);
    $input = $this.parent().find(".hiddenInputs");
    if($this.is(":checked")) {
      $input.slideDown();
    } else {
      $input.slideUp();
    }
  });
  $(".teampay").on("change", function() {
    $this = $(this);
    $input = $this.parent().find(".hiddenInput");
    if($this.is(":checked")) {
      $input.slideDown();
      $('#payment').slideDown();
    } else {
      $input.slideUp();
      $('#payment').slideUp();
    }
    if($this.is(":checked")) {
      $('#button').slideUp();
    } else {
      $('#button').slideDown();
    }

  });
  $(".free").on("change", function() {
    $this = $(this);
    $input = $(".teampay").parent().find(".hiddenInput");
    $input.slideUp();
    $('#payment').slideUp();
    if($this.is(":checked")) {
      $('#button').slideDown();
    } else {
      $('#button').slideDown();
    }
  });
  jQuery.fn.extend({
    disable: function(state) {
      return this.each(function() {
        var $this = $(this);
        $this.toggleClass('disabled', state);
      });
    }
  });
  $("#name").on("keyup", function() {
    var value = $( this ).val();
    var invalidChars = [  ];
    var name = new RegExp('^[A-Za-z]+$');
    if(value.match(name)) {
      $("#insert").html($("#name").val())
      $('#submits').prop('disabled', false);
      $("#nameGroup").removeClass('has-error')
      $('#errmsg').html('')
    } else {
      $("#nameGroup").addClass('has-error')
      $('#submits').prop('disabled', true);
      $('#errmsg').html('Username may only contain alphanumeric characters or single hyphens, and cannot begin or end with a hyphen.')
    }
  })
  $("#name").on("change", function() {
    var value = $( this ).val();
    var invalidChars = [  ];
    var name = new RegExp('^[A-Za-z]+$');
    if(value.match(name)) {
      $("#insert").html($("#name").val())
      $('#submits').prop('disabled', false);
      $("#nameGroup").removeClass('has-error')
      $('#errmsg').html('')
    } else {
      $("#nameGroup").addClass('has-error')
      $('#submits').prop('disabled', true);
      $('#errmsg').html('Username may only contain alphanumeric characters or single hyphens, and cannot begin or end with a hyphen.')
    }
  })
  var checkout;
  var checkout1;
  $('#radios-1').click(function(){
    $('#collapseExample').collapse()
    var button = document.querySelector('#submits');
  })
  $('#radios-0').click(function(){
  })
  $('.spinner .btn:first-of-type').on('click', function() {
    $('.spinner input').val( parseInt($('.spinner input').val(), 10) + 1);
    $('#count').html($('.spinner input').val())
    var basePrice = 400
    var userPrice = 100
    var count = $('.spinner input').val()
    if (count>5) {
      var price = ((count - 5)*userPrice)+basePrice
      $('#price').html(price+'.00')
      $('#amount').val(price)
    } else {
      $('#price').html(basePrice+'.00')
      $('#amount').val(basePrice)
    }
  });
  $('.spinner .btn:last-of-type').on('click', function() {
    $('.spinner input').val( parseInt($('.spinner input').val(), 10) - 1);
    $('#count').html($('.spinner input').val())
    var basePrice = 400
    var userPrice = 100
    var count = $('.spinner input').val()
    if (count>5) {
      var price = ((count - 5)*userPrice)+basePrice
      $('#price').html(price+'.00')
      $('#amount').val(price)
    } else {
      $('#price').html(basePrice+'.00')
      $('#amount').val(basePrice)
    }
  });
</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
<script type="text/javascript">
  var username = JSON.stringify('{{user.username}}')
  var user = JSON.stringify('{{user.username}}')
  var text = '{{user.image}}'
  text =text.replace("sz&#x3D;50", "sz&#x3D;200");
  $('#googlepic').html('<img src="'+text+'" style="max-width: 50%;border-radius: 2px;border: 1px;border-color: #d8d8d8;border-style: solid;" class="media-object">')
  var checkout;
//////////////////////////////////////////////////////
////        AJAX SUBMIT THE FORM - CREATE        //// 
////////////////////////////////////////////////////
function formPost(payload){
  var moredata = payload.nonce;
  $input = $('<input type="text" name="payload" style="display:none"/>').val(moredata);
  $('#theForm').append($input);
  var datastring = $('#theForm').serialize()
  $.ajax({
    type: "POST",
    url: '/users/'+username+'/subscription',
    data: datastring,
    dataType: "json",
    success: function(data) {
      window.location = '/users/'+username+'/settings/billing'; 
    },
    error : function(err){
      console.log('Not working')
      window.location = '/users/'+username+'/settings/billing'; 
    }
  }); 
}
////////////////////////
///// INITIALIZE //////
//////////////////////
$(document).ready( function() {
  months()
  years()
});
function price(ids){
  var price = $('#'+ids).data('price')
  var cycles = $('#'+ids).data('cycles')
  var frequency = $('#'+ids).data('frequency')

  $('#cycles').val(cycles)
  $('#amount').val(price)
  $('#frequency').val(frequency)

$('#pricing').html($('#'+ids).html())
       amount = price
     frequency = frequency
     console.log(frequency)
  buttonUpdate(amount,frequency)



}
////////////////////////////////
///// HANDLING THE DATES //////
//////////////////////////////
function months(){
  var datevalue = moment().add(1, 'M').format('YYYY-MM-DD');
  $('#dates').html(datevalue)

}
////////////////////////////////
///// HANDLING THE DATES //////
//////////////////////////////
function years(){
  var datevalue = moment().add(1, 'Y').format('YYYY-MM-DD');
  $('#years').html(datevalue)

}
  /*
  Super simple PayFast JS implementation with zero dependencies to other libraries.
  Certain functions pulled from all over the internet.
  */
  var createElement = (function () {
  // Detect IE using conditional compilation
  if (/*@cc_on@*//*@if (@_win32)!/*@end@*/false) {
    // Translations for attribute names which IE would otherwise choke on
    var attrTranslations =
    {
      "class": "className",
      "for": "htmlFor"
    };
    var setAttribute = function (element, attr, value) {
      if (attrTranslations.hasOwnProperty(attr)) {
        element[attrTranslations[attr]] = value;
      }
      else if (attr == "style") {
        element.style.cssText = value;
      }
      else {
        element.setAttribute(attr, value);
      }
    };
    return function (tagName, attributes) {
      attributes = attributes || {};
      // See http://channel9.msdn.com/Wiki/InternetExplorerProgrammingBugs
      if (attributes.hasOwnProperty("name") ||
        attributes.hasOwnProperty("checked") ||
        attributes.hasOwnProperty("multiple")) {
        var tagParts = ["<" + tagName];
      if (attributes.hasOwnProperty("name")) {
        tagParts[tagParts.length] = ' name="' + attributes.name + '"';
        delete attributes.name;
      }
      if (attributes.hasOwnProperty("checked") &&
        "" + attributes.checked == "true") {
        tagParts[tagParts.length] = " checked";
      delete attributes.checked;
    }
    if (attributes.hasOwnProperty("multiple") &&
      "" + attributes.multiple == "true") {
      tagParts[tagParts.length] = " multiple";
    delete attributes.multiple;
  }
  tagParts[tagParts.length] = ">";
  var element =
  document.createElement(tagParts.join(""));
}
else {
  var element = document.createElement(tagName);
}
for (var attr in attributes) {
  if (attributes.hasOwnProperty(attr)) {
    setAttribute(element, attr, attributes[attr]);
  }
}
return element;
};
}
  // All other browsers
  else {
    return function (tagName, attributes) {
      attributes = attributes || {};
      var element = document.createElement(tagName);
      for (var attr in attributes) {
        if (attributes.hasOwnProperty(attr)) {
          element.setAttribute(attr, attributes[attr]);
        }
      }
      return element;
    };
  }
})();
function postToURL(url, values) {
  values = values || {};
  var form = createElement("form", { action: url,
    method: "POST",
    style: "display: none"
  });
  for (var property in values) {
    if (values.hasOwnProperty(property)) {
      var value = values[property];
      if (value instanceof Array) {
        for (var i = 0, l = value.length; i < l; i++) {
          form.appendChild(createElement("input", 
            { type: "hidden",
            name: property,
            value: value[i]
          }));
        }
      }
      else {
        form.appendChild(createElement("input", { type: "hidden",
          name: property,
          value: value
        }));
      }
    }
  }
  document.body.appendChild(form);
  //console.log(form)
  form.submit();
  document.body.removeChild(form);
}
function validatePayFastResponse(payFastUrl, merchantId) {
  // Incomplete, would be a good idea to add some sort of callback here to validate the payment.
  if (merchantId != getParameter('merchant_id')) {
    alert('Invalid merchant ID in the response.');
    return false;
  }
}
function quickPostPaymentToPayFast(payFastUrl) {
  console.log('working')
  // Input filds with the specifid names must be present in the page, whether hidden or as user input, the gateway does validation as well if you don't do it yourself.
  postPaymentToPayFast(payFastUrl,
    document.getElementById('merchant_id').value, 
    document.getElementById('merchant_key').value, 
    document.getElementById('return_url').value, 
    document.getElementById('cancel_url').value,
    document.getElementById('notify_url').value,
    document.getElementById('name_first').value,
    document.getElementById('name_last').value,
    document.getElementById('email_address').value,
    document.getElementById('payment_id').value,
    document.getElementById('amount').value,
    document.getElementById('item_name').value,
    document.getElementById('item_description').value,
    document.getElementById('email_confirmation').value, 
    document.getElementById('confirmation_address').value,
    document.getElementById('subscription_type').value,
    document.getElementById('frequency').value,
    document.getElementById('cycles').value,
    document.getElementById('custom_str1').value,
    document.getElementById('custom_str2').value
    );
}
function postPaymentToPayFast(payFastUrl, merchantId, merchantKey, returnUrl, cancelUrl, notifyUrl,
  nameFirst, nameLast, emailAddress, paymentId, amount, itemName, itemDescription,
  emailConfirmation, confirmationAddress,subscription_type,frequency,cycles,custom_str1,custom_str2) {
  postToURL(payFastUrl, {'merchant_id':merchantId, 
    'merchant_key':merchantKey,
    'return_url':returnUrl,
    'cancel_url':cancelUrl,
    'notify_url':notifyUrl,
    'name_first':nameFirst,
    'name_last':nameLast,
    'email_address':emailAddress,
    'm_payment_id':paymentId,
    'amount':amount,
    'item_name':itemName,
    'item_description':itemDescription,
    'email_confirmation':emailConfirmation,
    'confirmation_address':confirmationAddress,
    'subscription_type':subscription_type,
    'frequency':frequency,
    'cycles':cycles,
    "custom_str1":custom_str1,
    "custom_str2":custom_str2,
  });
}
</script>


</body>
</html>